<html>
<head>
<title>Protocols for hearts</title>
</head>
<body>

<h1>Protocols for Hearts</h1>

<p>This is a small description of the protocols used by the hearts app and server.

<p>This is a documentation of the game available in <a href="http://hearts.luispedro.org/">hearts.luispedro.org</a>.</p>

<h2>Design</h2>

<p>There are two protocols used by hearts. For playing in the network, we first contact a public server to find out if there are any others in the same situation. This protocol lets users know of others, of whether they are available for games, etc. In the future, one might such functionality as the possibility to login with a given reserved name. The result of this phase is that four players are assembled. Here the second protocol comes into play. In it, the four players connect to a common game server which controls the whole game. This server might be on the internet, or it might be one of the players. If it is one of the players, the problem of users behind firewalls remain to be solved. Here the players exchange messages with the server whichcontrols the whole game. In the future this "game server" might report back to the "login server" the results of the game for user rating purposes.

<h2>Protocol basics</h2>

<p>The protocol is text-based. The enconding used is 8-bit Ascii. All text is exchanged in English and it is left for the app to translate if necessary. This makes possible for diffferent players to translate to different strings. Where sensible, the serverr replys with text-codes instead of the real text.

<p>The protocols are based in exchanging messages. These can be single messages or Request/Reply pairs. Each message starts by a codeword followed by a space-separated list of arguments (which can be empty) and ends with a unix-style newline character. 
Request/Reply pairs are identified by using the letters Q (for Query) and R (for Reply) at the end of a messagecode. For example, here is how the server asks for a player's name:

<pre>
NameQ&lt;NL&gt;
NameR "super trouper"&lt;NL&gt;
</pre>

<p>We also see another aspect in the small example: strings are quoted. In general numbers are passed as text in the obvious way, and strings are quoted. See each protocols description for more information on this.


<h2>Hearts Game Protocol</h2>

<p>This is the protocol used when the game is going on. It is used both when playing a network or a local game (a local game being a network game using Unix Protocol communication).

<h3>Server Messages</h3>
<dl>
	<dt><code>startGame</code>: startGame port
	<dd>Tells the client to start running a game server on the specified port
	<dt><code>connectTo</code>: connectTo host port
	<dd>Tells the client to connect to <tt>host:port</tt>.
	<dt><code>lookAt</code>: lookAt name player1 player2 player3 player4
	<dd>Informs the user of an existing table named <i>name</i> with players named 1 through 4. If any of these players are not set, the value passed is the special value <tt>[null]</tt>.
</dl>
<h3>Client Messages</h3>
<dl>
	<dt><code>createTable</code>:createTable name
	<dd>Tells the server to create a new table named <i>name</i>
	<dt><code>joinTable</code>: joinTable tableName
	<dd>Tells the server that the player wishes to joing the specified table. 
	<dt><code>leaveTable</code>: leaveTable
	<dd>Tells the server that the player wishes to leave the table it is currently on.
	<dt><code>hello</code>. hello name
	<dd>This should be the first message that the client sends. It advertises which name the player wishes to be known under. In the future there will probably be added a password or similar mechanism for doing this.
</dl>
<p>Whenever there is a change to the tables generated by one of the players, either with <code>createTable</code>, <code>joinTable</code> or <code>leaveTable</code>, other players, including the player which caused the change, will get a <code>lookAt</code> message reporting the new changes.
